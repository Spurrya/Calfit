(function(){if(!window.WL&&!window.OneDrive){window.OneDrive={};OneDrive.Constants={WebViewLink:Ib,DownloadLink:yc};OneDrive.open=function(c){var b=q(c),a=new t(b,ih);try{a.initialize();a.validateOpenParameters();a.executeOpenOperation()}catch(d){a.processError(d,Fb)}};OneDrive.save=function(c){var b=q(c),a=new t(b,jh);try{a.initialize();a.validateSaveParameters();a.executeSaveOperation()}catch(d){a.processError(d,Fb)}};OneDrive.createOpenButton=function(d){var c=q(d),a=new t(c,Bd);try{a.initialize();a.validateOpenParameters();a.validateButtonParameters();var b=a.createButtonElement();p(b,zb,function(){a.executeOpenOperation()});return b}catch(e){a.processError(e,Fb);return null}};OneDrive.createSaveButton=function(d){var c=q(d),a=new t(c,Nf);try{a.initialize();a.validateSaveParameters();a.validateButtonParameters();var b=a.createButtonElement();p(b,zb,function(){a.executeSaveOperation()});return b}catch(e){a.processError(e,Fb);return null}};function t(d,e){var b=this,c=d[Pg];b._internalApp=WL.UnitTests&&typeof c===lb?c:a;b._options=d;b._method=e}t.onloadInit=function(){cb(function(){var c=document.querySelectorAll(Zf);for(var b=0;b<c.length;b++){var a=c[b];t.createButtonElement(a,Kb,Z);var e=a.href,d=new t({file:e},Ef);a.href="#";p(a,zb,function(){d.initialize();d.executeSaveOperation();return false})}})};t.createButtonElement=function(a,e,d){var b={};b[y]=e;b[w]=d;var c=zd(b,true);a.innerHTML=c.innerHTML;a.id=c.buttonId;a.title=c.buttonTitle;Ed(b,a);return a};t.prototype={initialize:function(){var a=this;if(a._internalApp._status!==Kc){var b=Ph();if(!b)throw new Error(fg.replace(m,a._method));a._internalApp.appInit({client_id:b,interface_method:a._method});Si("Picker SDK initialized with client_id: "+b,fc)}},executeOpenOperation:function(){var b=this,f=b._internalApp,d=b._method,a=b._options,c=a[ce],g=a[Pb],h=a[Sb],e={mode:pb,resourceType:Hb,select:a[oe]?Bc:V,linkType:c,interface_method:d};f.fileDialog(e).then(function(j){var a=j.apiResponse,e=c===yc,m={link:e?null:a.webUrl,values:[]},f=e?a.value:a.children&&a.children.length>0?a.children:[a];if(!f)throw new Error(E(xd,d,JSON.stringify(j)));for(var h=0;h<f.length;h++){var b=f[h],l=[],n=e?b["@content.downloadUrl"]:b.webUrl,k=b.thumbnails&&b.thumbnails[0];if(k)for(var i=0;i<re.length;i++)l.push(k[re[i]].url);m.values.push({fileName:b.name,link:n,linkType:c,size:b.size,thumbnails:l})}u(g,m)},function(a){a.error===ab?u(h):b.processError(a,Kd)})},executeSaveOperation:function(){var a=this,b=a._internalApp,f=a._options,c=a._method,g=f[Be],e=f[Jc],d=ef;if(Bb(g)){d=jd;e=e||Qh(g)}else if(Di(g)){d=Tc;if(!e)throw Ob(Jc,c)}var h=f[Pb],i=f[de],k=f[Sb],j={mode:ob,resourceType:Gb,select:V,interface_method:c,save_scenario:true};b.fileDialog(j).then(function(l){var s=l.pickerResponse,j=l.apiResponse,k=b._browser.ie9,f;if(k)f=j.data&&j.data[0].id;else{f=j.value&&j.value[0]&&j.value[0].id;if(!f||j.value.length!==1)throw new Error(E(xd,c,JSON.stringify(l)))}var n=b.getAccessTokenForApi();switch(d){case Tc:case jd:if(k){var p=f.split(".");f=p.length>2?p[2]:"root"}var r={path:"drives/"+s.owner_cid+"/items/"+f+"/children",method:cd,use_vroom_api:true,request_headers:[{name:ei,value:Eg},{name:ui,value:"bearer "+n},{name:Lc,value:b._appId},{name:Fc,value:E("{0}={1}",Mc,b._settings.sdk_version)}],response_headers:[Wc],json_body:{"@content.sourceUrl":g,"name":e,"file":{}},interface_method:c};b.api(r).then(function(b){var c=b[Nc];if(d===Tc&&(c===Fg||c===Ee))u(h);else if(d===jd&&c===Vd)a.beginPolling(h,i,b[Wc],n);else a.processErrorCallback(b,Cc)},function(b){a.processErrorCallback(b,Cc)});break;case ef:var o;if(k)o=f;else{var t=bd(true)+"drive/items/"+f+"/children/{0}/content?"+eh;o=A(t,{access_token:n})}var q={path:o,element:g,use_vroom_api:!k,overwrite:Od,file_name:e,interface_method:c};b.upload(q).then(function(){u(h)},function(b){a.processErrorCallback(b,Cc)},function(a){u(i,a.progressPercentage)});break;default:throw new Error(Hf.replace(m,c))}},function(b){b.error===ab?u(k):a.processError(b,Kd)})},beginPolling:function(i,e,h,g){var a=this,b=ji,d=cf,f={path:A(h,{access_token:g}),method:dc,use_vroom_api:true,response_headers:[Wc],interface_method:a._method},c=function(){a._internalApp.api(f).then(function(f){switch(f[Nc]){case Vd:u(e,f[kg]);if(!d--){b*=2;d=cf}S(c,b);break;case Ee:u(e,100);u(i);break;default:a.processErrorCallback(f,Ad)}},function(b){a.processErrorCallback(b,Ad)})};S(c,b)},validateOpenParameters:function(){h(this._options,[{name:ce,type:b,optional:true,defaultValue:Ib,allowedValues:[yc,Ib]},{name:oe,type:jb,optional:true,defaultValue:false},{name:Pb,type:e,optional:false},{name:Sb,type:e,optional:true}],this._method)},validateSaveParameters:function(){h(this._options,[{name:Jc,type:b,optional:true},{name:Be,type:b,optional:false},{name:Pb,type:e,optional:true},{name:de,type:e,optional:true},{name:Sb,type:e,optional:true},{name:se,type:e,optional:true}],this._method)},validateButtonParameters:function(){h(this._options,[{name:te,type:b,optional:true,defaultValue:Ec,allowedValues:[Ec,mg]}],this._method)},createButtonElement:function(){var a=document.createElement("button"),c=this._method===Bd?W:Kb,b=this._options[te]===Ec?Z:qb;return t.createButtonElement(a,c,b)},processError:function(c,b){var a=E(Lh,this._method,b,JSON.stringify(c));k(a,fc);return a},processErrorCallback:function(b,a){u(this._options[se],this.processError(b,a))}};var Fi="download",f="interface_method",Jf="WL.Internal.jsonp.",ye=2000,Lc="Application",ui="Authorization",ff="body",zh="json_body",r="callback",jc="code",ne="Content-Type",Q="element",Ze="error",cj="error_description",tb="file_name",Ah="file_input",dj="file_output",Qd="request_headers",jg="response_headers",Wc="Location",Le="logging",Zb="message",eb="method",J="overwrite",Od="rename",s="path",kg="percentageComplete",ei="Prefer",fi="pretty",Eg="respond-async",gi="result",Rg="save_scenario",Mc="SDK-Version",jj="status",Nc="http_status",fh="return_ssl_resources",bj="stream_input",hj="tracing",bb="use_vroom_api",Fc="X-RequestStats",kj="error",Vd=202,Fg=201,Ee=200,Xi=500,fj="success",ge="suppress_redirects",eg="suppress_response_codes",N="x_http_live_library",af=0,Kc=1,d="access_token",Gi="appstate",Hi="authentication_key";AK_AUTH_TOKEN="authentication_token",(AK_CLIENT_ID="client_id",(AK_DISPLAY="display",(AK_CODE="code",(AK_ERROR="error",(AK_ERROR_DESC="error_description",(AK_EXPIRES="expires",(AK_EXPIRES_IN="expires_in",(AK_ITEMID="item_id",(AK_LOCALE="locale",(AK_OWNER_CID="owner_cid",(AK_REDIRECT_URI="redirect_uri",(AK_RESPONSE="response",(AK_RESPONSE_TYPE="response_type",(AK_REQUEST_TS="request_ts",(AK_RESOURCEID="resource_id",(AK_SCOPE="scope",(AK_SESSION="session",(AK_SECURE_COOKIE="secure_cookie",(AK_STATE="state",AK_STATUS="status")))))))))))))))))));var ic=[d,AK_AUTH_TOKEN,AK_SCOPE,AK_EXPIRES_IN,AK_EXPIRES],D="connected",li="notConnected",R="unchecked",Db="unknown",tc="expiring",pj="expired",nj="live-sdk-upload",ij="live-sdk-download",Pi="appId",Bi="channelUrl",vf="wl_auth",kf="wl_upload",nf="page",kd="touch",rc="none",We="none",cc="auth.login",Zc="auth.logout",X="auth.sessionChange",Hc="auth.statusChange",Af="wl.log",ab="access_denied",Jg="connection_failed",Kh="invalid_cookie",gh="invalid_request",xb="request_canceled",z="request_failed",kc="timed_out",gj="unknown_user",ej="user_canceled",xg="METHOD: Failed to get the required user permission to perform this operation.",yg="The request could not be completed due to browser issues.",Xd="The request could not be completed due to browser limitations.",Vf="The request could not be completed since the browser or browser version is not supported.",ag="Callback has thrown an exception. Exception message: MESSAGE",ac="METHOD: The operation has been canceled.",Sd="The 'wl_auth' cookie is not valid.",Jd="The 'wl_auth' cookie has been modified incorrectly. Ensure that the redirect URI only modifies sub-keys for values received from the OAuth endpoint.",Rf="The 'wl_auth' cookie has multiple values. Ensure that the redirect URI specifies a cookie domain and path when setting cookies.",Ug="METHOD: The input property 'PARAM' does not reference a valid DOM element.",ph="METHOD: An exception was received for EVENT. Detail: MESSAGE",Vg="METHOD: The WL object must be initialized with WL.init() prior to invoking this method.",be="A connection to the server could not be established.",Wi="The user could not be identified.",Wg="METHOD: Failed to get upload_location of the resource.",Kg="The pending login request has been canceled.",Wf="Logging out the user is not supported in current session because the user is logged in with a Microsoft account on this computer. To logout, the user may quit the app or log out from the computer.",Yd="METHOD: The input value for parameter/property 'PARAM' is not valid.",zg="METHOD: The input parameter/property 'PARAM' must be included.",bg="METHOD: The type of the provided value for the input parameter/property 'PARAM' is not valid.",xc="METHOD: There is a pending METHOD request, the current call will be ignored.",Pf=xc.replace(/METHOD/g,L),Ff=xc.replace(/METHOD/g,ub),Ui=xc.replace(/METHOD/g,Se),Xf="METHOD: The input property 'redirect_uri' is required if the value of the 'response_type' property is 'code'.",Mf="WL.init: The redirect_uri value should be the same as the value of 'Redirect Domain' of your registered app. It must begin with 'http://' or 'https://'.",Vi="METHOD: The api call is not supported on this platform.",Ti="WL.init: The response_type value 'code' is not supported on this platform.",Mh="METHOD: The input property 'redirect_uri' must use https: to match the scheme of the current page.",Ag="The auth request is timed out.",Xg="The popup is closed without receiving consent.",ad=0,sg=1,Zd=2,Oh=3,dc="GET",cd="POST",qi="PUT",Sh="DELETE",lj="COPY",mj="MOVE",ub="WL.fileDialog",lc="WL.api",rb="WL.download",ec="WL.init",L="WL.login",pc="WL.ui",Se="WL.upload",Ng=30000,m="METHOD",Eb="PARAM",n="onSuccess",o="onError",G="onProgress",qc="redirect_type",Je="auth",ue="upload",Th="code",sb="token",sc="https:",pd="http:",pf="wl.signin",yi="wl.skydrive",mh="wl.skydrive_update",bi=/\s|,/,jb="boolean",uc="dom",e="function",wf="number",lb="object",gc="properties",b="string",Yb="string_or_array",hb="undefined",Qi="url",Ei="name",fb="element",mc="brand",nd="type",Tb="sign_in_text",Qb="sign_out_text",w="theme",De="onloggedin",we="onloggedout",yb="onerror",Uh="messenger",ki="hotmail",ci="skydrive",dd="windows",ve="windowslive",md="none",td="signin",Pc=td,xe="login",le="connect",qe="custom",Z="blue",qb="white",df="id",hc="onedrive_api",oc="auth_server",wb="apiservice_uri",Ab="skydrive_uri",T="sdk_root",vc="wl_trace";window.WL={getSession:function(){try{return a.getSession()}catch(b){k(b.message)}},getLoginStatus:function(){try{return a.getLoginStatus({callback:He(arguments,e,2),internal:false},He(arguments,jb,2))}catch(d){return H("WL.getLoginStatus",d)}},logout:function(b){try{nc(b,M,"WL.logout");return a.logout({callback:b})}catch(c){return H("WL.logout",c)}},canLogout:function(){return a.canLogout()},api:function(){try{var c=kh(arguments);h(c,[{name:s,type:b,optional:false},{name:eb,type:b,optional:true},M],lc);return a.api(c)}catch(f){return H(lc,f)}}};var jf=[cc,Zc,X,Hc,Af];WL.Event={subscribe:function(d,a){try{nc([d,a],[{name:"event",type:b,allowedValues:jf,caseSensitive:true,optional:false},pg],"WL.Event.subscribe");c.subscribe(d,a)}catch(e){k(e.message)}},unsubscribe:function(d,a){try{nc([d,a],[{name:"event",type:b,allowedValues:jf,caseSensitive:true,optional:false},M],"WL.Event.unsubscribe");c.unsubscribe(d,a)}catch(e){k(e.message)}}};WL.Internal={};var c={subscribe:function(a,b){i("Subscribe "+a);var d=c.getHandlers(a);d.push(b)},unsubscribe:function(d,f){i("Unsubscribe "+d);var b=c.getHandlers(d),e=[];if(f!=null){var g=false;for(var a=0;a<b.length;a++)if(g||b[a]!=f)e.push(b[a]);else g=true}c._eHandlers[d]=e},getHandlers:function(b){if(!c._eHandlers)c._eHandlers={};var a=c._eHandlers[b];if(a==null)c._eHandlers[b]=a=[];return a},notify:function(d,e){i("Notify "+d);var b=c.getHandlers(d);for(var a=0;a<b.length;a++)b[a](e)}},a={_status:af,_statusRequests:[],_rpsAuth:false};a.appInit=function(b){var e=b[f]||ec;if(a._status==Kc){var g=a._session.getNormalStatus();return Y(e,true,b.callback,g)}var c=WL[T];if(c){if(c.charAt(c.length-1)!=="/")c+="/";a[T]=c}var d=b[Le];if(d===false)a._logEnabled=d;if(a.testInit)a.testInit(b);a._status=Kc;return Gg(b)};a.onloadInit=function(){vi();xi()};function B(b){if(a._status===af)throw new Error(Vg.replace(m,b))}function sd(){return WL.Internal.tApp||a}a.api=function(a){B(lc);var c=a[ff];if(c){a=q(hd(c),a);delete a[ff]}var b=a[eb];a[eb]=(b!=null?U(b):dc).toUpperCase();return (new xf(a)).execute()};a.getAccessTokenForApi=function(){var c=null;if(!a._rpsAuth){var b=sd()._session.getStatus();if(b.status===tc||b.status===D)c=b.session[d]}return c};var rh=function(){var b=a.api.lastId,c;b=b===undefined?1:b+1;c="WLAPI_REQ_"+b+"_"+(new Date).getTime();a.api.lastId=b;return c},xf=function(b){var c=this;c._properties=b;c._completed=false;c._id=rh();b[fi]=false;b[fh]=a._isHttps;b[N]=a[N];var d=b[s],e=b[bb];c._url=Bb(d)?d:bd(e)+(d.charAt(0)==="/"?d.substring(1):d);c._promise=new l(lc,null,null)};xf.prototype={execute:function(){Yh(this);return this._promise},onCompleted:function(a){if(this._completed)return;this._completed=true;v(this._properties.callback,a,true);if(a[AK_ERROR])this._promise[o](a);else this._promise[n](a)}};function Yc(f,c,b,e,d){b=b?U(b):"";var a=b!==""?ed(b):null;if(a===null){a={};if(Math.floor(c/100)!==2)a[Ze]=Vh(c,e)}if(d)d.forEach(function(b){a[b.name]=b.value});a[Nc]=c;f.onCompleted(a)}function Vh(c,b){var a={};a[jc]=z;a[Zb]=b||be;return a}function hd(i){var c={};for(var b in i){var a=i[b],j=typeof a;if(a instanceof Array)for(var d=0;d<a.length;d++){var f=a[d],l=typeof f;if(j==lb&&!(a instanceof Date)){var h=hd(f);for(var e in h)c[b+"."+d+"."+e]=h[e]}else c[b+"."+d]=f}else if(j==lb&&!(a instanceof Date)){var k=hd(a);for(var g in k)c[b+"."+g]=k[g]}else c[b]=a}return c}function wh(c){if(!Oi())return false;var b=Te(c),a=new XMLHttpRequest;a.open(b.method,b.url,true);b.requestHeaders.forEach(function(b){a.setRequestHeader(b.name,b.value)});a.onreadystatechange=function(){if(a.readyState===4){var d=[];b.responseHeaders.forEach(function(b){d.push({name:b,value:a.getResponseHeader(b)})});Yc(c,a.status,a.responseText,null,d)}};a.send(b.body);return true}function Te(e){var g=e._url,f=e._properties[eb],k=a.getAccessTokenForApi(),i=null,b=Ne(e._properties,null,[r,s,eb]),h=b[Qd]||[],l=b[jg]||[],j=b[zh],c=b[bb];b[ge]="true";if(k)b[d]=k;if(!c)A(g,{ts:(new Date).getTime(),method:f});switch(f){case dc:case Sh:if(!c)A(g,b);break;default:i=c?JSON.stringify(j):K(b);h.push({name:ne,value:"application/"+(j?"json":"x-www-form-urlencoded")})}return {url:g,method:f,requestHeaders:h,responseHeaders:l,body:i}}a.download=function(a){ng(a);B(rb);return (new Pe(a)).execute()};function he(b,f){var c=f||{},g=bd();if(!Bb(b))b=g+(b.charAt(0)==="/"?b.substring(1):b);var e=a.getAccessTokenForApi();if(e)c[d]=e;c[N]=a[N];return A(b,c)}var Id="notStarted",ie="ready",wc="downloadCompleted",Fd="downloadFailed",Rd="canceled",lg="completed";function Pe(a){this._properties=a;this._status=Id}Pe.prototype={execute:function(){this._promise=new l(rb,this,null);this._process();return this._promise},cancel:function(){this._status=Rd;if(this._cancel)try{this._cancel()}catch(a){}else{this._result=j(xb,ac.replace(m,rb));this._process()}},downloadComplete:function(b,c){var a=this;a._result=c;a._status=b?wc:Fd;a._process()},downloadProgress:function(a){this._promise[G](a)},_process:function(){switch(this._status){case Id:this._start();break;case ie:this._download();break;case wc:case Fd:case Rd:this._complete()}},_start:function(){var b=this;a.getLoginStatus({internal:true,callback:function(){b._status=ie;b._process()}})},_download:function(){var a=this;oi(a)},_complete:function(){var a=this,c=a._result,d=a._status===wc?n:o;a._status=lg;var b=a._properties[r];if(b)b(c);a._promise[d](c)}};a.login=function(b,e,d){B(L);Bh(b);if(!Rh(e))return Y(L,false,null,j(z,Pf));var c=a._session.tryGetResponse(b.normalizedScope);if(c!=null)return Y(L,true,b.callback,c);a._pendingLogin=Jh(b,Zg,d);return a._pendingLogin.execute()};function Zg(c,b){a._pendingLogin=null;var d=b[AK_ERROR];if(d)nb(L+": "+b[AK_ERROR_DESC]);else v(c.callback,b,true)}function Ae(b){var a=b||"";if(a instanceof Array)a=a.join(" ");return U(a)}a.getSession=function(){B("WL.getSession");return a._session.getStatus()[AK_SESSION]};a.getLoginStatus=function(b,f){B("WL.getLoginStatus");b=b||{};if(!f){var d=a._session.tryGetResponse();if(d)return Y("WL.getLoginStatus",true,b.callback,d)}i("wl_app:getLoginStatus");var e=a._statusRequests,c=null;if(!a._pendingStatusRequest){c=wg(b,ug);a._pendingStatusRequest=c}e.push(b);if(c!=null)c.execute();return a._pendingStatusRequest._promise};function ug(h,b){var f=a._statusRequests;a._pendingStatusRequest=null;i("wl_app:onGetLoginStatusCompleted");var d=b[AK_ERROR],e=false;while(f.length>0){var c=f.shift(),g=q(b);if(!d||c.internal)v(c.callback,g,true);if(!c.internal)e=true}if(d)if(e&&d!==kc)nb("WL.getLoginStatus: "+b[AK_ERROR_DESC]);else i("wl_app-onGetLoginStatusCompleted: "+b[AK_ERROR_DESC])}a.logout=function(f){var b="WL.logout";B(b);var d=new l(b,null,null),c=function(c){S(function(){var e,g=n;if(c){k(c.message);g=o;e=Nb(b,b,c)}else e=a._session.getNormalStatus();v(f.callback,e,false);d[g](e)})},e=function(){var b=a._session;if(b.isSignedIn())if(a.canLogout()){b.updateStatus(Db);Zh(c)}else c(new Error(Wf));else c()};if(a._pendingStatusRequest!=null)a.getLoginStatus({internal:true,callback:e},false);else e();return d};a.upload=function(a){var c=a[f];B(c);h(a,[{name:s,type:b,optional:false},M],c);Sf(a);Og(a);return (new fd(a)).execute()};function Og(a){var b=a[Ah],c=a[tb];if(b)a[tb]=c||b.name}function cg(a,h,i){var c=a.indexOf("?"),e=c!==-1,g="";if(e){g=a.substring(c+1);a=a.substring(0,c)}var f=typeof h!==hb,j=a.charAt(a.length-1)==="/";if(f&&!j)a+="/";var b=a,d={};if(f)b+=encodeURIComponent(h);if(i===Od)d[J]="choosenewname";else d[J]=i;if(e)b=Me(b,g);return Gc(b,d)}function Ki(a){return /^(file|\/file)/.test(a.toLowerCase())}function Gc(b,a){a=a||{};a[eg]="true";return he(b,a)}function Sf(a){if(J in a){var c=a[f],d=a[J],g=typeof d,i=g===jb,e=g===b;if(!(i||e))throw I(J,c);if(e){var h=/^(true|false|rename)$/i.test(d);if(!h)throw O(J,c)}}else a[J]=false}var Ud=0,ae=1,Dc=2,Ac=3,Jb=4,ee=5,Dg=6;function fd(a){this._props=a;this._status=Ud}fd.prototype={execute:function(){var a=this;a._strategy=a._getStrategy(a._props);a._promise=new l(a._props[f],a,null);a._process();return a._promise},cancel:function(){var a=this;a._status=ee;if(a._cancel)try{a._cancel()}catch(c){}else{var b=ac.replace(m,a._props[f]);a._result=j(xb,b);a._process()}},uploadProgress:function(a){this._promise[G](a)},uploadComplete:function(b,c){var a=this;a._result=c;a._status=b?Ac:Jb;a._process()},onErr:function(c){var a=this._props[f]+":"+c,b=j(z,a);this.uploadComplete(false,b)},onResp:function(a){a=a?U(a):"";var b=a!==""?ed(a):null;b=b||{};this.uploadComplete(b.error==null,b)},setFileName:function(a){this._props[tb]=a},_process:function(){switch(this._status){case Ud:this._start();break;case ae:this._getUploadPath();break;case Dc:this._upload();break;case Ac:case Jb:case ee:this._complete()}},_start:function(){var a=this;sd().getLoginStatus({internal:true,callback:function(){a._status=ae;a._process()}})},_getUploadPath:function(){var a=this,c=a._props,b=c[s];if(Bb(b)){a._uploadPath=c[bb]?b:Gc(b);a._status=Dc;a._process();return}sd().api({path:b}).then(function(i){var d=i.upload_location;if(d){var e=ii(b);d=Me(d,e);var g=c[tb],h=c[J];if(Ki(b))a._uploadPath=Gc(d);else a._uploadPath=cg(d,g,h);a._status=Dc}else{a._result=j(z,Wg.replace(m,c[f]));a._status=Jb}a._process()},function(b){a._result=b;a._status=Jb;a._process()})},_upload:function(){this._strategy.upload(this._uploadPath)},_complete:function(){var a=this,c=a._result,d=a._status===Ac?n:o;a._status=Dg;var b=a._props[r];if(b)b(c);a._promise[d](c)}};var vh=new RegExp("^\\w+\\.\\w+:\\w+[\\|\\w+]+:([\\w]+\\!\\d+)(?:\\!(.+))*");function U(a){return a.replace(/^\s+|\s+$/g,"")}function Td(a,b){return a&&b?a.toLowerCase()===b.toLowerCase():a===b}function Ce(a){return a==null||a===""}function E(){var a=arguments,c=a[0];function b(b){return a[parseInt(b.replace(/[\{\}]/g,""))+1]||""}return c.replace(/\{\d+\}/g,b)}var yf="0000000000000000";function Li(a){return yf.substring(0,yf.length-a.length)+a}function rd(b){var a={c:0,s:-1};return b.replace(/[^\w .,-]/g,function(d,b,c){if(Nh(c,b,a))return ["&#",a.c,";"].join("");return ""})}function Nh(f,b,a){var d=a.s===b;if(!d){b=b||0;var c=f.charCodeAt(b),g,e;a.s=-1;if(c<55296||c>57343)a.c=c;else if(c<=56319){g=c;e=f.charCodeAt(b+1);a.c=(g-55296)*1024+(e-56320)+65536;a.s=b+1}else{a.c=-1;d=true}}return !d}function q(b,d){var c=d||{};if(b!=null)for(var a in b)c[a]=b[a];return c}function Ne(e,d,b){var c=q(e,d);for(var a=0;a<b.length;a++)delete c[b[a]];return c}function Ai(b,c){var a;for(a=0;a<b.length;a++)if(b[a]===c)return true;return false}function zf(a){return Array.prototype.slice.call(a)}function g(b,a){return function(){if(typeof a===e)return a.apply(b,arguments)}}function Cf(a,g,d){d=d||"[WL]";a=d+a;var c=window;if(c.debugLogger)c.debugLogger.push(a);var b=c.console;if(b&&b.log)switch(g){case "warning":b.warn(a);break;case "error":b.error(a);break;default:b.log(a)}var f=c.opera;if(f)f.postError(a);var e=c.debugService;if(e)e.trace(a)}function Bb(a){return a.indexOf("https://")===0||a.indexOf("http://")===0}function Di(a){return a.indexOf("data:")===0}function i(b){if(a._traceEnabled)Cf(b)}function nb(b,e,d){if(a._logEnabled||a._traceEnabled)Cf(b,e,d);c.notify(Af,b)}if(window.WL&&WL.Internal){WL.Internal.trace=i;WL.Internal.log=nb}function Si(b,a){nb(b,"text",a)}function k(b,a){nb(b,"error",a)}function Ge(b,c){var a=Ub("iframe");a.id=c;a.src=b;document.body.appendChild(a);return a}function Ub(b){var a=document.createElement(b);a.style.position="absolute";a.style.top="-1000px";a.style.width="300px";a.style.height="300px";a.style.visibility="hidden";return a}function Oc(){var a=null;while(a==null){a="wl_"+Math.floor(Math.random()*1024*1024);if(gb(a)!=null)a=null}return a}function gb(a){return document.getElementById(a)}function zi(a,b){if(a)if(a.innerText)a.innerText=b;else{var c=document.createTextNode(b);a.innerHTML="";a.appendChild(c)}}function ii(b){var a=b.indexOf("?");if(a===-1)return "";var c=b.indexOf("#",a+1);if(c!==-1)return b.substring(a+1,c);return b.substring(a+1)}function Me(a,b){if(typeof b===hb||b===null||b==="")return a;var c=a.indexOf("?");if(c===-1)return a+"?"+b;if(a.charAt(a.length-1)!=="&")a+="&";return a+b}function wd(a){q(vd(a),this)}wd.prototype={toString:function(){var a=this,b=(a.scheme!=""?a.scheme+"//":"")+a.host+(a.port!=""?":"+a.port:"")+a.path;return b},resolve:function(){var a=this;if(a.scheme==""){var b=window.location.port,c=window.location.host;a.scheme=window.location.protocol;a.host=c.split(":")[0];a.port=b!=null?b:"";if(a.path.charAt(0)!="/")a.path=Dh(a.host,window.location.href,a.path)}}};function vd(c){var e=c.indexOf(sc)==0?sc:c.indexOf(pd)==0?pd:"",l="",m="",f;if(e!="")var a=c.substring(e.length+2),h=Xb(a.indexOf("/")),j=Xb(a.indexOf("\\")),i=Xb(a.indexOf("?")),k=Xb(a.indexOf("#")),b=Ih(Math.min(h,j,i,k)),g=b>0?a.substring(0,b):a,d=g.split(":"),l=d[0],m=d.length>1?d[1]:"",f=b>0?a.substring(b):"";else f=c;return {scheme:e,host:l,port:m,path:f}}function Xb(a){if(a==-1)return Number.POSITIVE_INFINITY;return a}function Ih(a){if(a==Number.POSITIVE_INFINITY)return -1;return a}function Ci(a){return vd(a.toLowerCase()).host}function Dh(e,b,h){var d=function(a,c){charIdx=b.indexOf(c);a=charIdx>0?a.substring(0,charIdx):a;return a};b=d(d(b,"?"),"#");var f=b.indexOf(e),a=b.substring(f+e.length),g=a.indexOf("/"),c=a.lastIndexOf("/");a=c>=0?a.substring(g,c):a;return a+"/"+h}function rf(a){var b=a.indexOf("?");if(b>0)a=a.substring(0,b);b=a.indexOf("#");if(b>0)a=a.substring(0,b);return a}function Qh(c){var a=rf(c),b=a.lastIndexOf("/")+1;return a.substr(b)}function u(a,b){v(a,b,true)}function v(a,c,d){function b(){try{c!==undefined?a(c):a()}catch(b){k(ag.replace("MESSAGE",b.message));throw b}}if(typeof a==e)if(d)b();else S(function(){b()})}function ed(a){return JSON.parse(a)}function Re(){return Math.floor((new Date).getTime()/1000)}function Ri(b,c){var d=b.length;for(var a=0;a<d;a++)c(b[a])}function mi(c,b){var a={};a[AK_ERROR]=c;a[AK_ERROR_DESC]=b;return a}function j(d,c){var a={},b={};a[jc]=d,a[Zb]=c;b[Ze]=a;return b}function Nb(a,b,c){return j(z,ph.replace("METHOD",a).replace("EVENT",b).replace("MESSAGE",c.message))}function dh(b){var a=b.split(".");return a[0]+"."+a[1]}function S(a,b){window.wlUnitTests?wlUnitTests.delayInvoke(a):window.setTimeout(a,b||1)}function vi(){var b=wi(navigator.userAgent,document.documentMode),c=a[N];a._browser=b;a[N]=c.replace("DEVICE",b.device)}function wi(a,e){a=a.toLowerCase();var c="other",b={"firefox":/firefox/.test(a),"firefox1.5":/firefox\/1\.5/.test(a),"firefox2":/firefox\/2/.test(a),"firefox3":/firefox\/3/.test(a),"firefox4":/firefox\/4/.test(a),"ie":(/msie/.test(a)||/trident/.test(a))&&!/opera/.test(a),"ie6":false,"ie7":false,"ie8":false,"ie9":false,"ie10":false,"ie11":false,"opera":/opera/.test(a),"webkit":/webkit/.test(a),"chrome":/chrome/.test(a),"mobile":/mobile/.test(a)||/phone/.test(a)};if(b["ie"]){var d=0;if(e)d=e;else if(/msie 7/.test(a))d=7;d=Math.min(11,Math.max(d,6));c="ie"+d;b[c]=true}else if(b.firefox)c="firefox";else if(b.chrome)c="chrome";else if(b.webkit)c="webkit";else if(b.opera)c="opera";if(b.mobile)c+="mobile";b.device=c;return b}function Rb(e,c){var f=c!=null?c:{};if(e!=null){var d=e.split("&");for(var b=0;b<d.length;b++){var a=d[b].split("=");if(a.length==2)f[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}}return f}function K(a){var c="";if(a!=null)for(var b in a)if(a.hasOwnProperty(b)){var d=c.length?"&":"",e=a[b];c+=d+encodeURIComponent(b)+"="+encodeURIComponent(Eh(e))}return c}function Eh(a){if(a instanceof Date){var b=function(a,b){switch(b){case 2:return a<10?"0"+a:a;case 3:return (a<10?"00":a<100?"0":"")+a}};return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"."+b(a.getUTCMilliseconds(),3)+"Z"}return ""+a}function ai(b){var d=b.indexOf("?")+1,c=b.indexOf("#")+1,a={};if(d>0){var e=c>d?c-1:b.length;a=Rb(b.substring(d,e),a)}if(c>0)a=Rb(b.substring(c),a);return a}function A(a,b){return a+(a.indexOf("?")<0?"?":"&")+K(b)}function lh(a){switch(typeof a){case jb:return a;case wf:return !!a;case b:return a.toLowerCase()==="true";default:return false}}var M={name:r,type:e,optional:true},pg={name:r,type:e,optional:false};function nc(a,c,d){if(a instanceof Array)for(var b=0;b<a.length;b++)lf(a[b],c[b],d);else lf(a,c,d)}function lf(c,a,b){Ue(c,a,b);if(a.type===gc)h(c,a.properties,b)}function Ue(g,f,c,h){var d=f.name,a=typeof g,i=f.type;if(a===hb||g==null)if(f.optional){h&&h();return}else throw Ob(d,c);switch(i){case b:if(a!=b)throw I(d,c);if(!f.optional&&U(g)==="")throw Ob(d,c);break;case Qi:if(a!=b||!Bb(g))throw I(a,c);break;case gc:if(a!=lb)throw I(d,c);break;case e:if(a!=e)throw I(a,c);break;case uc:if(a==b){if(gb(g)==null)throw new Error(Ug.replace(m,c).replace(Eb,d))}else if(a!=lb)throw I(d,c);break;case Yb:if(a!=b&&!(g instanceof Array))throw I(a,c);break;default:if(a!=i)throw I(d,c)}if(f.allowedValues!=null)xh(g,f.allowedValues,f.caseSensitive,d,c)}function h(g,d,f){var b=g||{};for(var c=0;c<d.length;c++){var a=d[c],e=b[a.name]||b[a.altName];Ue(e,a,f,function(){if(typeof a.defaultValue!=hb)b[a.name]=a.defaultValue})}}function xh(d,a,e,f,h){var g=typeof a[0]===b;for(var c=0;c<a.length;c++)if(g&&!e){if(d.toLowerCase()===a[c].toLowerCase())return}else if(d===a[c])return;throw O(f,h)}function I(a,b){return new Error(bg.replace(m,b).replace(Eb,a))}function Ob(a,b){return new Error(zg.replace(m,b).replace(Eb,a))}function O(c,d,a){var b=Yd.replace(m,d).replace(Eb,c);if(typeof a!==hb)b+=" "+a;return new Error(b)}function He(b,d,c){if(b)for(var a=0;a<c&&a<b.length;a++)if(d===typeof b[a])return b[a];return undefined}function db(j,i){var g=zf(j),a=null,b=null;for(var d=0;d<g.length;d++){var c=g[d],h=typeof c;if(h===lb&&a===null)a=q(c);else if(h===e&&b===null)b=c}a=a||{};if(b)a.callback=b;a[f]=i;return a}function kh(e){var a=zf(e),d=null,c=null;if(typeof a[0]===b){d=a.shift();if(typeof a[0]===b)c=a.shift()}normalizedArgs=db(a);if(d!==null){normalizedArgs[s]=d;if(c!=null)normalizedArgs[eb]=c}return normalizedArgs}function H(a,b){var c=Nb(a,a,b);k(b.message);return Y(a,false,null,c)}var l=function(b,c,a){this._name=b;this._op=c;this._uplinkPromise=a;this._isCompleted=false;this._listeners=[]};l.prototype={then:function(d,e,c){var b=new l(null,null,this),a={};a[n]=d;a[o]=e;a[G]=c;a.chainedPromise=b;this._listeners.push(a);return b},cancel:function(){if(this._isCompleted)return;if(this._uplinkPromise&&!this._uplinkPromise._isCompleted)this._uplinkPromise.cancel();else{var a=this._op?this._op.cancel:null;if(typeof a===e)this._op.cancel();else this.onError(j(xb,ac.replace("METHOD",this._getName())))}},_getName:function(){if(this._name)return this._name;if(this._op&&typeof this._op._getName===e)return this._op._getName();if(this._uplinkPromise)return this._uplinkPromise._getName();return ""},_onEvent:function(b,a){if(this._isCompleted)return;this._isCompleted=a!==G;this._notify(b,a)},_notify:function(b,a){var c=this;Ri(this._listeners,function(g){var h=g[a],d=g.chainedPromise,f=a!==G;if(h)try{var e=h.apply(g,b);if(f&&e&&e.then){d._op=e;e.then(function(a){d[n](a)},function(a){d[o](a)},function(a){d[G](a)})}}catch(i){if(f)d.onError(Nb(c._getName(),a,i))}else if(f)d[a].apply(d,b)})}};l.prototype[n]=function(){this._onEvent(arguments,n)};l.prototype[o]=function(){this._onEvent(arguments,o)};l.prototype[G]=function(){this._onEvent(arguments,G)};function Y(f,d,b,g){var a=new l(f,null,null),c=d?n:o;if(typeof b===e)a.then(function(a){b(a)});S(function(){a[c](g)});return a}var ic=[d,AK_AUTH_TOKEN,AK_SCOPE,AK_EXPIRES_IN,AK_EXPIRES,AK_REQUEST_TS,AK_ERROR,AK_ERROR_DESC],Ye="refresh_type",yh="app",Uc="ms",Vc="response_method",fe="url",Pd="cookie",Wb="onanalytics",Fe="login",Wd="loginstatus",Hg="file_dialog",Vb="auth.response",Oe="client-id",Zf=".OneDriveSaveButton",ud="file",zb="click",qd="onedrive-js",ke="2px",Md="0px",ze="4px",fg="METHOD: Failed to initialize due to missing 'client-id'.",og="Loading OneDrive picker is timed out.",y="mode",W="open",Kb="save",pb="read",ob="readwrite",Mb="linkType",Hd="resourceType",Hb="file",Gb="folder",P="select",V="single",Bc="multi",hg="permission",Kf="onetime",Lb="lightbox",Yf="grey",yd="transparent",zc="white",Dd="loading_timeout",Ld="onselected",Sb="cancel",se="error",Be="file",Jc="fileName",Pg="internal_app",ce=Mb,yc="downloadLink",Ib="webViewLink",de="progress",oe="multiSelect",Pb="success",te="theme",Ec="blue",mg="white",jd="content_url",Tc="data_url",ef="form",Hf="METHOD: This upload method is not implemented.",Lh="{0}: Operation: '{1}' Error message: {2}",xd="{0}: Invalid response from the file picker. Response: {1}",aj="API call",Kd="invoke picker",Fb="unhandled exception",Cc="upload",Ad="upload: poll for completion",ih="OneDrive.open",jh="OneDrive.save",Bd="OneDrive.createOpenButton",Nf="OneDrive.createSaveButton",Ef="OneDriveApp.onloadInit",Zi="OneDriveApp.initialize",hh="auth",qg="rps",gg="oauth",rg="v",Gf="1",If="2",Lg="domain",Bg="livesdk",qh="mkt";FILEDIALOG_PARAM_PICKER_SCRIPT="pickerscript";FILEDIALOG_CHCMD_ONCOMPLETE="onPickerComplete",FILEDIALOG_CHCMD_UPDATETOKEN="updateToken";var Yg=104857600,Ji=27,ji=1000,cf=5,fc="[OneDrive]",bc="skydrivepicker",eh="@name.conflictBehavior=rename",Qg="select=id,@content.downloadUrl,name,size&expand=thumbnails",Of="select=id,webUrl,name,size&expand=thumbnails,children(select=id,webUrl,name,size;expand=thumbnails)",ti="select=id",re=["large","medium","small"];WL.init=function(e){try{var c=q(e),d=ec;nc(c,{name:gc,type:gc,optional:false,properties:[{name:AK_CLIENT_ID,altName:Pi,type:b,optional:false},{name:AK_SCOPE,type:Yb,optional:true},{name:AK_REDIRECT_URI,altName:Bi,type:b,optional:true},{name:AK_RESPONSE_TYPE,type:b,allowedValues:[Th,sb],optional:true},{name:Ye,type:b,allowedValues:[yh,Uc],optional:true},{name:Le,type:jb,optional:true},{name:AK_STATUS,type:jb,optional:true}]},d);if(!c[AK_REDIRECT_URI]&&c[AK_RESPONSE_TYPE]===AK_CODE)throw new Error(Xf.replace(m,d));if(c[AK_STATUS]==null)c[AK_STATUS]=true;return a.appInit(c)}catch(f){return H(d,f)}};WL.login=function(){try{var d=db(arguments),c=L;h(d,[{name:AK_SCOPE,type:Yb,optional:true},{name:AK_REDIRECT_URI,type:b,optional:true},{name:AK_STATE,type:b,optional:true},M],c);return a.login(d)}catch(g){return H(c,g)}};WL.download=function(){try{var b=rb,c=db(arguments,b);return a.download(c)}catch(f){return H(b,f)}};WL.upload=function(){try{var b=Se,c=db(arguments,b);return a.upload(c)}catch(f){return H(b,f)}};WL.ui=function(){try{var c=db(arguments);h(c,[{name:Ei,type:b,allowedValues:[td,bc],optional:false},M],pc);a.ui(c)}catch(f){je(c,f)}};WL.fileDialog=function(){try{var b=ub,c=db(arguments,b);me(c,b);return a.fileDialog(c)}catch(f){return H(b,f)}};function me(d,c){h(d,[{name:y,type:b,allowedValues:[W,Kb,pb,ob],optional:false},{name:Hd,type:b,allowedValues:[Hb,Gb],optional:true},{name:P,type:b,allowedValues:[V,Bc],optional:true},{name:Lb,type:b,allowedValues:[Yf,yd,zc],optional:true},{name:Dd,type:wf,optional:true},{name:hg,type:b,allowedValues:[Kf],optional:true},M],c);if(c!==ub)h(d,[{name:w,allowedValues:[Z,qb],type:b,optional:true},{name:Ld,type:e,optional:false},{name:yb,type:e,optional:true}],c);if(!gd.isSupported()||!window.JSON||a._browser.mobile)throw new Error(Xd)}function uh(){a._urlParams=ai(window.location.href);a._pageState=Rb(a._urlParams[AK_STATE])}function Ke(){var b=new Cb(vf);b.load();var c=a._urlParams,e=a._pageState,h=true,k=e[AK_REQUEST_TS];if(k)if(k!=b.get(AK_REQUEST_TS))b.set(AK_REQUEST_TS,e[AK_REQUEST_TS]);else h=false;var i=c[d]!=null,l=b.get(d)!=null||i,m=l?D:Db,n=Re();if(e[Vc]===fe){for(var g=0;g<ic.length;g++){var f=ic[g];if(c[f])b.set(f,c[f])}if(i){b.set(AK_EXPIRES,n+parseInt(c[AK_EXPIRES_IN]));b.remove(AK_ERROR);b.remove(AK_ERROR_DESC)}else if(!l)if(c[AK_ERROR]===ab)m=li}else if(h){var j=Ig(b);if(j){b.set(AK_ERROR,Kh);b.set(AK_ERROR_DESC,j)}}else return;b.set(AK_STATUS,m);b.save()}function hi(){var b=a._pageState,g=b[qc];if(g===ue){var j=b[df],i=a._urlParams[gi];sh(j,i);return}var c=b[AK_DISPLAY],h=b[AK_SECURE_COOKIE]==="true";a._logEnabled=true;a._traceEnabled=b[vc]||a._urlParams[vc];a._secureCookie=h;Tg();if(c===nf||c===kd){Ke();if(c===kd&&a._browser.ie){var f=b[AK_REDIRECT_URI];Fh(f);document.location=f}else window.close()}else if(c===rc)Ke();else{cb(ri);var d=window.wlAsyncInit;if(d&&typeof d===e)d.call()}}function Fh(d){if(d!=null){var c=new wd(d);if(c.scheme!=""){var a=window.location.host,b=c.host;if(b==a)return;a="."+a;if(b.indexOf(a,b.length-a.length)!==-1)return}throw new Error(Mf.replace("WL.init","WL.login"))}}function th(a,b){if(!a)a=rf(window.location.href);return Lf(a,window.location.hostname,b)}function Lf(f,e,d){var b=new wd(f);b.resolve();var e=e.split(":")[0].toLowerCase(),c=b.host.toLowerCase();a._domain=a._domain||c;if(a._isHttps&&b.scheme==pd)throw new Error(Mh.replace("METHOD",d));return b.toString()}function Ig(a){var h=a.get(d)!=null,f=a.get(AK_ERROR)!=null,g=a.get(AK_SCOPE)!=null,c=a.get(AK_EXPIRES_IN)!=null,e=a.get(AK_CLIENT_ID)!=null,b=null;if(!(h&&g&&c)&&!f){k(Sd);b=Sd}if(!e){k(Jd);b=Jd}return b}function xi(){ye=a._browser.ie?2000:4000;uh();hi()}function sh(c,b){var a=new Cb(kf);a.load();a.set(c,b);a.save()}function Gg(b){a._authScope=Ae(b[AK_SCOPE]);a._secureCookie=lh(b[AK_SECURE_COOKIE]);a._redirect_uri=th(b[AK_REDIRECT_URI],ec);a._response_type=(b[AK_RESPONSE_TYPE]||sb).toLowerCase();a._appId=b[AK_CLIENT_ID];a._refreshType=(b[Ye]||Uc).toLowerCase();var g=new sf(b[AK_CLIENT_ID],vf);a._session=g;var d=g.getNormalStatus(),h=d[AK_STATUS],e,f=ec;if(h==D){c.notify(X,d);c.notify(Hc,d);c.notify(cc,d);e=Y(f,true,b.callback,d)}else if(b[AK_STATUS]){e=new l(f,null,null);a.getLoginStatus({internal:true,callback:function(a){var b=!!a.error?o:n;e[b](a)}},true)}return e}function Rh(){var b=a._pendingLogin;if(b!=null){b.cancel();a._pendingLogin=null}return true}function Bh(c){var b=Ae(c[AK_SCOPE]);if(b==="")b=a._authScope;if(!b||b==="")throw Ob(AK_SCOPE,L);c.normalizedScope=b}function Jh(c,b,a){return new od(Fe,c,b,a)}function wg(b,a){return new od(Wd,b,a)}a.ensurePermission=function(d,e,f,b){var c=j(ab,xg.replace("METHOD",f));a.login({scope:d}).then(function(f){if(f.session[AK_EXPIRES_IN]<e)a.getLoginStatus({internal:true},true).then(function(){a.login({scope:d}).then(function(a){b(a)},function(){b(c)})},function(){b(c)});else b(f)},function(){b(c)})};a.canLogout=function(){return true};function Zh(e){Ve();var b=Ub("iframe"),d=Qe(),f="/oauth20_logout.srf?ts=";b.src="//"+d+f+(new Date).getTime();var c=function(){Ve(e)};if(b.attachEvent)b.attachEvent("onload",c);else b.onload=c;document.body.appendChild(b);a.logoutFrame=b;window.setTimeout(c,30000)}function Ve(b){if(a.logoutFrame!=null){document.body.removeChild(a.logoutFrame);a.logoutFrame=null;b&&b()}}function je(c,b){k(b.message);var a=c[yb];if(a)S(function(){error=Nb(pc,pc,b),a(error)})}function gf(){return a[T]}function of(){return gf()+"images"}var ld=function(c){var a=this;a._properties=c;var b=g(a,a.init);cb(b)};ld.prototype={init:function(){var d=this,e=d._properties;if(d._inited===true)return;d._inited=true;try{d.validate();var f=e[fb],h=e[nd],m=e[r],j=e[Tb],i=e[Qb];ig(e);f=typeof f===b?gb(e[fb]):f;d._element=f;h=h!=null?h:Pc;if(h==Pc){j=x.signIn;i=x.signOut}else if(h==xe){j=x.login;i=x.logout}else if(h==le){j=x.connect;i=x.signOut}d[Tb]=j;d[Qb]=i;qf(f,Sg(e));var k=a._session.isSignedIn(),l=k?i:j;d.updateUI(l,k);Tf(d,f.childNodes[0]);c.subscribe(cc,g(d,d.onLoggedIn));c.subscribe(Zc,g(d,d.onLoggedOut));a.getLoginStatus({internal:true});delete e[r];v(m,e,false)}catch(n){je(e,n)}},validate:function(){var a=this._properties;h(a,[{name:fb,type:uc,optional:false},{name:nd,allowedValues:[Pc,xe,le,qe],type:b,optional:true},{name:AK_SCOPE,type:Yb,optional:true},{name:AK_STATE,type:b,optional:true},{name:De,type:e,optional:true},{name:we,type:e,optional:true},{name:yb,type:e,optional:true}],"WL.ui-signin");Df(a);var c=a[nd];if(c==qe)h(a,[{name:Tb,type:b,optional:false},{name:Qb,type:b,optional:false}],"WL.ui-signin")},fireEvent:function(b,c){var a=this._properties[b];if(a)a(c)},onClick:function(){var b=this;if(b._element.childNodes.length==0){Gd(b);return false}if(a._session.isSignedIn()){if(a.canLogout())a.logout({})}else a.login(b._properties,true).then(function(){},function(a){b.fireEvent(yb,a)});return false},onLoggedIn:function(a){this.updateUI(this[Qb],true);this.fireEvent(De,a)},onLoggedOut:function(a){this.updateUI(this[Tb],false);this.fireEvent(we,a)}};function ig(b){if(a._authScope&&a._authScope!=="")b[AK_SCOPE]=a._authScope;if(!b[AK_SCOPE])b[AK_SCOPE]=pf}function Qf(d,a,c){a._handlers=a._handlers||{};var b=g(a,c);a._handlers[d]=b;return b}function dg(b,a){return a._handlers[b]}a.ui=function(a){B(pc);switch(a.name){case td:new ld(a);break;case bc:new pe(a)}};function Df(a){h(a,[{name:w,allowedValues:[Z,qb],type:b,optional:true},{name:mc,allowedValues:[Uh,ki,ci,dd,ve,md],type:b,optional:true}],"WL.ui-signin");a[w]=a[w]||Z;a[mc]=a[mc]||dd}function Sg(f){var d=f[mc],e=f[w],g=a._locale,b=g.indexOf("ar")>-1||g.indexOf("he")>-1?"RTL":"LTR",h="cursor:pointer;background-color:transparent;border:solid 0px;display:inline-block;overflow:hidden;white-space:nowrap;padding:0px;width:auto;",c="margin:0px;padding:0px;border-width:0px;vertical-align:middle;background-attachment:scroll;display:inline-block;white-space:nowrap;",k=Sc(d,b,e,"left")+c,i=Sc(d,b,e,"center")+c,j=Sc(d,b,e,"right")+c;return '<button style="'+h+'"><span style="'+k+'"></span><span style="'+i+'"><span style="'+tg(b)+'"></span></span><span style="'+j+'"></span></button>'}function tg(g){var b=a._browser,j=b.ie6||b.ie7,k=b.ie8||b.ie9,f=b.chrome||b.safari?"padding:2px 3px;margin:0px;":"padding:1px 3px;margin:0px;",h="font-family: Segoe UI, Verdana, Tahoma, Helvetica, Arial, sans-serif;",e="direction:"+g.toLowerCase()+";",d="text-decoration:none;color:#3975a0;display:inline-block;",c="150";switch(a._locale){case "ar-ploc-sa":if(!j)c="170";break;case "te":case "ja-ploc-jp":if(b.ie)c="190"}var i="height:18px;font-size:9pt;font-weight:bold;line-height:"+c+"%;";return f+e+d+h+i}function Sc(a,b,i,g){a=a==dd?ve:a;var h=a+"_"+b+"_"+i,e,d,c,f="background: url({imgpath}/signincontrol/{image}.png) scroll {repeat} 0px {vpos}; height: 22px; width: {width};";switch(g){case "left":e=a===md||b==="RTL"?"3px":"25px";d=b==="LTR"?"0px":"-44px";c="no-repeat";break;case "center":e="auto";d="-22px";c="repeat-x";break;case "right":e=a===md||b==="LTR"?"3px":"25px";d=b==="LTR"?"-44px":"0px";c="no-repeat"}return f.replace("{imgpath}",of()).replace("{image}",h).replace("{vpos}",d).replace("{width}",e).replace("{repeat}",c)}ld.prototype.updateUI=function(d){if(this._element.childNodes.length==0){Gd(this);return}if(d!=this._text){var c=a._browser,b=this._element.childNodes[0],e=b.childNodes[1];zi(e.childNodes[0],d);this._text=d;if(c.ie6||c.ie7){e.style.width="auto";b.style.width="auto";var h=b.childNodes[0].clientWidth,f=b.childNodes[1].clientWidth,g=b.childNodes[2].clientWidth,i=h+f+g;b.style.width=i+"px";if(c.ie6){b.childNodes[0].style.width=h+"px";b.childNodes[1].style.width=f+"px";b.childNodes[2].style.width=g+"px"}}}};function Tf(a,b){a._button=b;p(b,"click",Qf("click",a,a.onClick))}function Gd(a){var b=a._button;if(b){C(b,"click",dg("click",a));delete a._button}}var pe=function(b){me(b);var a=this;a._props=b;cb(g(a,a.init))};pe.prototype={init:function(){var a=this;if(a._inited===true)return;a._inited=true;try{var c=a._props,d=c[fb],e=c[r];c[f]="WL.ui-"+bc;a.validate();c[w]=c[w]||qb;d=typeof d===b?gb(c[fb]):d;a._element=d;var h=Uf(c);qf(d,h);vg(d,g(a,a.onClick),g(a,a.onRender));a.onRender(false,false);v(e,c,false)}catch(i){k(i.message)}},validate:function(){var a=this._props;h(a,[{name:fb,type:uc,optional:false}],a[f])},onClick:function(){try{return a.fileDialog(this._props)}catch(b){k(b.message)}return false},onRender:function(){Ed(this._props,this._element.childNodes[0])}};function Ed(k,d){var h=k[w]===qb,j=a._locale,f=j.indexOf("ar")>-1||j.indexOf("he")>-1,l=f?"RTL":"LTR",n=d.childNodes[0],m=d.childNodes[1],e="#094AB2",i="#ffffff",b=d.style,g=n.style,c=m.style;b.direction=l;b.backgroundColor=h?i:e;b.border="solid 1px";b.borderColor=e;b.height="20px";b.paddingLeft=ze;b.paddingRight=ze;b.textAlign="center";b.cursor="pointer";if(d instanceof HTMLAnchorElement){b.lineHeight="20px";b.display="inline-block";b.textDecoration="none"}g.verticalAlign="middle";g.height="16px";c.fontFamily="'Segoe UI', 'Segoe UI Web Regular', 'Helvetica Neue', 'BBAlpha Sans', 'S60 Sans', Arial, 'sans-serif'";c.fontSize="12px";c.fontWeight="bold";c.color=h?e:i;c.textAlign="center";c.verticalAlign="middle";c.marginLeft=f?Md:ke;c.marginRight=f?ke:Md}function Uf(b){var a=zd(b,false);return "<button id='"+rd(a.buttonId)+"' title='"+rd(a.buttonTitle)+"'>"+a.innerHTML+"</button>"}function zd(b,c){var m=b[y],l=b[w],a=m===W,e=a?x.skyDriveOpenPickerButtonText:x.skyDriveSavePickerButtonText,i=l===Z?"SkyDriveIcon_white.png":"SkyDriveIcon_blue.png",h="<img alt='' src='"+of()+"/SkyDrivePicker/"+i+"'>",g="<span>"+rd(e)+"</span>",d=a?x.skyDriveOpenPickerButtonTooltip:x.skyDriveSavePickerButtonTooltip,j=c?"onedriveopenpickerbutton":"skydriveopenpickerbutton",k=c?"onedrivesavepickerbutton":"skydrivesavepickerbutton",f=a?j:k;return {innerHTML:h+g,buttonTitle:d,buttonId:f}}function vg(c,l,k){var a=c.childNodes[0];if(l){var f=function(b){if(c.childNodes.length==0){C(a,zb,f);return}l(b)};p(a,zb,f)}if(k){var d=false,e=false,g=function(a){e=true;b(a)},h=function(a){e=false;b(a)},i=function(a){d=true;b(a)},j=function(a){d=false;b(a)},b=function(){if(c.childNodes.length==0){C(a,"mouseenter",g);C(a,"mouseleave",h);C(document,"mousedown",i);C(document,"mouseup",j);return}k(d,e)};p(a,"mouseenter",g);p(a,"mouseleave",h);p(document,"mousedown",i);p(document,"mouseup",j)}}function Mi(c){var a=document.cookie;c+="=";var b=a.indexOf(c);if(b>=0){b+=c.length;var d=a.indexOf(";",b);if(d<0)d=a.length;else{postCookie=a.substring(d);if(postCookie.indexOf(c)>=0)throw new Error(Rf)}var e=a.substring(b,d);return e}return ""}function Bf(g,d,f,e){d=d?d:"";var c=g+"="+d+"; path=/";if(f&&f!="localhost")c+="; domain="+encodeURIComponent(f);if(e!=null){var b=new Date(0);if(e>0){b=new Date;b.setTime(b.getTime()+e*1000)}c+=";expires="+b.toUTCString()}if(a._isHttps&&a._secureCookie)c+=";secure";document.cookie=c}var Cb=function(a,b){this._cookieName=a;this._states=b||{};this._listeners=[];this._cookieWatcher=null};Cb.prototype={getStates:function(){return this._states},get:function(a){return this._states[a]},set:function(b,a){this._states[b]=a},remove:function(a){if(this._states[a])delete this._states[a]},load:function(){try{var a=Mi(this._cookieName);if(this._rawValue!=a){i("Cookie changed: "+this._cookieName+"="+a);this._rawValue=a;this._states=Rb(a);for(var b=0;b<this._listeners.length;b++)this._listeners[b]()}}catch(c){k(c.message);this.stopMonitor()}},flush:function(a){this._states=a;this.save()},populate:function(a){q(a,this._states);this.save()},save:function(){Bf(this._cookieName,K(this._states),bf(),null)},clear:function(){this._states={};Bf(this._cookieName,"",bf(),0)},addCookieChanged:function(a){this._listeners.push(a);this.startMonitor()},startMonitor:function(){this._refreshInterval=300;if(!this._cookieWatcher){i("Started monitoring cookie: "+this._cookieName);this._cookieWatcher=window.setInterval(g(this,this.load),this._refreshInterval)}},stopMonitor:function(){if(this._cookieWatcher){i("Stopped monitoring cookie: "+this._cookieName);window.clearInterval(this._cookieWatcher);this._cookieWatcher=null}},isBeingMonitored:function(){return this._cookieWatcher!==null}};function bf(){var b=a._domain||window.location.hostname.split(":")[0];return b}var od=function(d,b,c){var a=this;a._method=d;a._completed=false;a._requestFired=false;a._properties=b;a._callback=c;a._authMonitor=g(a,a._onAuthChanged);a.execute=a._method==Fe?a._login:a._getLoginStatus};od.prototype={cancel:function(){this._onComplete({error:xb,error_description:Kg})},_login:function(){var b=this;b._requestTs=(new Date).getTime();var e=a._browser.mobile,d=e&&a._browser.ie,h=e?kd:nf,f=mf(h,b._properties.normalizedScope,Xc(b._properties),b._requestTs,d,b._properties.state);if(d)document.location=f;else{b._popup=Ni(f,b._properties.external_consent);i("AuthRequest-login: popup is opened. "+b._popup);b._popupWatcher=window.setInterval(g(b,b._checkPopup),3000);c.subscribe(Vb,b._authMonitor)}b._promise=new l(L,null,null);return b._promise},_getLoginStatus:function(){Ch(g(this,this._fireStatusRequest));this._timeout=window.setTimeout(g(this,this._onTimedOut),Ng);this._promise=new l("WL.getLoginStatus",null,null);return this._promise},_fireStatusRequest:function(){var b=this;if(!b._requestFired){b._requestTs=(new Date).getTime();var d=a._refreshType===Uc?mf(rc,a._authScope,Xc(),b._requestTs,false):Hh(Xc(),a._authScope,b._requestTs);b._statusFrame=Ge(d);c.subscribe(Vb,b._authMonitor);b._requestFired=true}},_onAuthChanged:function(){var b=a._session.tryGetResponse(this._properties.normalizedScope,this._requestTs,this._properties.external_consent);if(b!=null)this._onComplete(this._normalizeResp(b))},_normalizeResp:function(b){if(this._method===Wd&&b.error===ab)return a._session.getNormalStatus();return b},_onTimedOut:function(){this._onComplete({error:kc,error_description:Ag})},_checkPopup:function(){try{if(this._popup===null)this._onComplete({error:ab,error_description:Xg});else if(this._popup.closed)this._popup=null}catch(a){i("AuthRequest-checkPopup-error: "+a)}},_onComplete:function(a){if(!this._completed){this._completed=true;this._dispose();this._callback(this._properties,a);if(a[AK_ERROR])this._promise[o](a);else this._promise[n](a)}},_dispose:function(){i("AuthRequest: dispose "+this._method);if(this._timeout){window.clearTimeout(this._timeout);this._timeout=null}if(this._statusFrame!=null){document.body.removeChild(this._statusFrame);this._statusFrame=null}if(this._popupWatcher){window.clearInterval(this._popupWatcher);this._popupWatcher=null}c.unsubscribe(Vb,this._authMonitor)}};function Ni(q,h){var c=525,b=525,e,d;if(h){c=800;b=650}if(a._browser.ie){var l=window.screenLeft,m=window.screenTop,f=document.documentElement,j=30;d=l+Math.max(f.clientWidth-c,0)/2;e=m+Math.max(f.clientHeight-b,0)/2-j}else{var o=window.screenX,p=window.screenY,k=window.outerWidth,i=window.outerHeight;d=o+Math.max(k-c,0)/2;e=p+Math.max(i-b,0)/2}var n=["width="+c,"height="+b,"top="+e,"left="+d,"status=no","resizable=yes","toolbar=no","menubar=no","scrollbars=yes"],g=window.open(q,"oauth",n.join(","));g.focus();return g}function Hh(d,h,f){var b={};b[qc]=Je;b[AK_REQUEST_TS]=f;b[AK_SECURE_COOKIE]=a._secureCookie;b[AK_DISPLAY]=rc;b[Vc]=Pd;if(a.trace)b[vc]=true;var i=K(b),c={};c[AK_CLIENT_ID]=a._session.get(AK_CLIENT_ID);c[AK_RESPONSE_TYPE]=sb;c[AK_SCOPE]=h;c[AK_STATE]=i;var g=d.indexOf("?")>0,e=g?"&":"?",j=d+e+K(c);return j}function mf(d,l,h,j,k,f){var b={};b[qc]=Je;b[AK_DISPLAY]=d;b[AK_REQUEST_TS]=j;if(k)b[AK_REDIRECT_URI]=window.location.href;if(a.trace)b[vc]=true;if(f)b[Gi]=f;var e=d===rc?sb:a._response_type,g=e===sb?fe:Pd;b[Vc]=g;b[AK_SECURE_COOKIE]=a._secureCookie;var m=K(b),c={};c[AK_CLIENT_ID]=a._session.get(AK_CLIENT_ID);c[AK_DISPLAY]=d;c[AK_LOCALE]=a._locale;c[AK_REDIRECT_URI]=h;c[AK_RESPONSE_TYPE]=e;c[AK_SCOPE]=l;c[AK_STATE]=m;var i=Qe(),n="https://"+i+"/oauth20_authorize.srf?"+K(c);return n}function Xc(c){var b=c!=null?c[AK_REDIRECT_URI]:null;return b!=null&&b!=""?b:a._redirect_uri}var sf=function(b,a){this._state={};this._state[AK_CLIENT_ID]=b;this._state[AK_STATUS]=R;this._cookieName=a;this.init()};sf.prototype={get:function(a){return this._state[a]},save:function(){if(this._stateDirty){this._cookie.flush(this._state);this._stateDirty=false}},init:function(){var a=new Cb(this._cookieName);a.load();this._cookie=a;if(a.get(AK_CLIENT_ID)!=this._state[AK_CLIENT_ID]){a.clear();a.flush(this._state)}else this._state=a.getStates();var b=this._state[AK_STATUS];this._statusChecked=b!==Db&&b!==R;this._cookie.addCookieChanged(g(this,this.onCookieChanged))},refresh:function(){a.getLoginStatus({internal:true},true);this._refresh=undefined},scheduleRefresh:function(){this.cancelRefresh();var a=(this.tokenExpiresIn()-600)*1000;if(a>0)this._refresh=window.setTimeout(g(this,this.refresh),a)},cancelRefresh:function(){if(this._refresh){window.clearTimeout(this._refresh);this._refresh=undefined}},updateStatus:function(a){var b=this._state[AK_STATUS],e=this._state[d];if(b!=a){this._state[AK_STATUS]=a;this._stateDirty=true;this.onStatusChanged(b,a);this.save();if(e!=this._state[d])c.notify(X,this.getNormalStatus())}},onStatusChanged:function(b,a){i("AuthSession: Auth status changed: "+b+"=>"+a);if(b!=a){var g=b==D,d=a==D;if(!d){for(var e=0;e<ic.length;e++){var f=ic[e];if(this._state[f])delete this._state[f]}this._stateDirty=true;this.save()}if(Ic(b)!=Ic(a))c.notify(Hc,this.getNormalStatus());if(d!=g)if(d)c.notify(cc,this.getNormalStatus());else c.notify(Zc,this.getNormalStatus())}},isSignedIn:function(){return this._state[AK_STATUS]===D},getNormalStatus:function(){var a=this.getStatus();a[AK_STATUS]=Ic(a[AK_STATUS]);return a},tokenExpiresIn:function(){var a=this._state,c=a[AK_STATUS],b=parseInt(a[AK_EXPIRES]);if(c===D)return b-Re();return -1},onCookieChanged:function(){var b=this._state,a=this._cookie.getStates();this._state=a;i("AuthSession: cookie changed. Has token: "+(a[d]!=null));this._statusChecked=a[AK_STATUS]!==R;if(b[d]!=a[d]||b[AK_ERROR]!=a[AK_ERROR]||b[AK_REQUEST_TS]!=a[AK_REQUEST_TS]){c.notify(Vb);delete a[AK_ERROR];delete a[AK_ERROR_DESC];this._stateDirty=true}if(b[AK_STATUS]!=a[AK_STATUS])this.onStatusChanged(b[AK_STATUS],a[AK_STATUS]);if(b[d]!=a[d]){c.notify(X,this.getNormalStatus());if(a[d])this.scheduleRefresh();else this.cancelRefresh()}this.save()},getStatus:function(){var b=null,c=this._state[AK_STATUS],l=null,e=null,i=null,o=null;if(c===D){var g=this.tokenExpiresIn();if(g<=10){c=this._statusChecked?Db:R;this.updateStatus(c);window.setTimeout(function(){a.getLoginStatus({internal:true},true)},30000)}else{if(g<60)c=tc;b={};b[d]=this._state[d];b[AK_AUTH_TOKEN]=this._state[AK_AUTH_TOKEN];var k=this._state[AK_SCOPE].split(" ");b[AK_SCOPE]=[];for(var f=0;f<k.length;f++){var j=vh.exec(k[f]);if(j){var n=j[1].split("_"),p=n[0],h=n[1],m=h.indexOf("!"),q=h.substring(0,m),r=h.substring(m);e=Li(q);i=e+r;l=[p,e,i].join(".");o=j[2]}else b[AK_SCOPE].push(k[f])}this._state[AK_SCOPE]=b[AK_SCOPE].join(" ");b[AK_EXPIRES_IN]=g;b[AK_EXPIRES]=this._state[AK_EXPIRES]}}else if(!this._statusChecked)c=R;return {status:c,session:b,resource_id:l,owner_cid:e,item_id:i,authentication_key:o}},tryGetResponse:function(b,e,h){i("AuthSession.tryGetResponse: requestTs = "+e+" scope = "+b);var a=this.getStatus(),g=a[AK_STATUS],l=a[AK_RESOURCEID],c=a[AK_SESSION];if(g==R||g==tc)return null;if(e===undefined)if(b)return c&&Xe(c[AK_SCOPE],b)?a:null;else return a;var f=this._state,j=parseInt(f[AK_REQUEST_TS]),d=f[AK_ERROR],k=f[AK_ERROR_DESC];if(j>=e){if(c&&(!d&&h||Xe(c[AK_SCOPE],b)))return a;if(d)return mi(d,k);if(!b)return a}return null}};function Xe(e,a){if(a==null||U(a)=="")return true;var c=a.split(bi);for(var b=0;b<c.length;b++){var d=U(c[b]);if(d!=""&&!Ai(e,d))return false}return true}function Ic(a){return a===R?Db:a===tc?D:a}function Yh(a){if(!a._properties[bb]&&bh(a))return;if(wh(a))return;if(ah(a))return;var b={};b[jc]=z;b[Zb]=Xd;a.onCompleted(b)}function Oi(){return window.XMLHttpRequest&&(new XMLHttpRequest).withCredentials!==undefined}function Qe(){return a[oc]}function bd(b){return b?a[hc]:a[wb]}function ng(a){h(a,[{name:s,type:b,optional:false}],a[f])}function oi(a){var b=a._properties,c=b[s];ch(c,a)}var ch=function(){var a=null,b=1;return function(c){var d={};d[Fi]=b;c=he(c,d);if(a===null){var e=Oc();a=Ge(c,e)}else a.src=c}}();a.jsonp={};WL.Internal.jsonp=a.jsonp;function bh(c){var i=document.getElementsByTagName("HEAD")[0],b=document.createElement("SCRIPT"),e=Ne(c._properties,e,[r,s]),f=c._id,g=a.getAccessTokenForApi();if(g!=null)e[d]=g;e[r]=Jf+f;e[ge]="true";var h=A(c._url,e);if(h.length>ye)return false;c.scriptTag=b;a.jsonp[f]=function(a){Qc(f,b);c.onCompleted(a)};Gh(b,c);b.setAttribute("async","async");b.type="text/javascript";b.src=h;i.appendChild(b);window.setTimeout(function(){if(c._completed)return;Qc(f,b)},30000);return true}function Gh(b,c){if(a._browser.ie&&b.attachEvent)b.attachEvent("onreadystatechange",function(a){id(a,c)});else{b.readyState="complete";b.addEventListener("load",function(a){id(a,c)},false);b.addEventListener("error",function(a){id(a,c)},false)}}function id(d,c){if(c._completed)return;var b=d.srcElement||d.currentTarget;if(!b.readyState)b=d.currentTarget;if(b.readyState!="complete"&&b.readyState!="loaded")return;var f=c._id;failure=d.type=="error"||a.jsonp[f]!=null;if(failure){Qc(f,c.scriptTag);var e={};e[jc]=Jg;e[Zb]=be;c.onCompleted({error:e})}}function Qc(b,c){delete a.jsonp[b];document.getElementsByTagName("HEAD")[0].removeChild(c)}function ah(b){Ii();if(a._browser.flashVersion<9)return false;a.xdrFlash.send(b);return true}a.xdrFlash={_id:"",_status:ad,_flashObject:null,_requests:{},_pending:[],init:function(){if(this._status!=ad)return;this._status=sg;var c=Ub("div");c.id="wl_xdr_container";document.body.appendChild(c);this._id=Oc();var b=Mg,d=a[T]+"XDR.swf";b=b.replace(/{url}/g,d);b=b.replace(/{id}/g,this._id);b=b.replace(/{variables}/g,"domain="+document.domain);c.innerHTML=b},onReady:function(b){if(b){if(a._browser.firefox)this._flashObject=document.embeds[this._id];else this._flashObject=gb(this._id);this._status=Zd}else this._status=Oh;while(this._pending.length>0)this.send(this._pending.shift())},onRequestCompleted:function(b,e,c,f){var d=a.xdrFlash._requests[b];delete a.xdrFlash._requests[b];Yc(d,e,ni(c),f)},send:function(a){if(this._status<Zd){this._pending.push(a);if(this._status==ad)cb(g(this,this.init));return}if(this._flashObject!=null){this._requests[a._id]=a;var b=Te(a);this.invoke("send",[a._id,b.url,b.method,b.body])}else Yc(a,0,null,yg)},invoke:function(d,a){a=a||[];var c=window.__flash__argumentsToXML(a,0),e='<invoke name="'+d+'" returntype="javascript">'+c+"</invoke>",b=this._flashObject.CallFunction(e);if(b==null)return null;return eval(b)}};WL.Internal.xdrFlash=a.xdrFlash;function ni(a){return a?a.replace(/\r/g," ").replace(/\n/g," "):a}var Mg="<object classid='clsid:d27cdb6e-ae6d-11cf-96b8-444553540000' codebase='https://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0' width='300' height='300' id='{id}' name='{id}' type='application/x-shockwave-flash' data='{url}'>"+"<param name='movie' value='{url}'></param>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='FlashVars' value='{variables}'></param>"+"<embed play='true' menu='false' swLiveConnect='true' allowScriptAccess='always' type='application/x-shockwave-flash' FlashVars='{variables}' src='{url}' width='300' height='300' name='{id}'></embed>"+"</object>",Rc=null;(function(){a.fileDialog=function(b){B(b[f]);if(a._pendingPickerOp!=null)throw new Error(Ff);return (new Rc(b)).execute()};var i=0,b=1,h=2,e=3;Rc=function(c){var b=this;b._props=c;b._startTs=(new Date).getTime();c[Lb]=c[Lb]||zc;c[P]=c[P]||V;b._state=i;b._authDelegate=g(b,b._onAuthResp);a._pendingPickerOp=b};Rc.prototype={execute:function(){var a=this,b=new l(a._props[f],a,null);a._promise=b;a._process();return b},cancel:function(a){var b=this;if(b._state===e)return;if(!a)a=j(xb,ac.replace(m,b._props[f]));b._onComplete(a)},_process:function(){var a=this;switch(a._state){case i:a._validateAuth();break;case b:a._initPicker();break;case h:a._complete()}},_changeState:function(c,b){var a=this;if(a._state!==e&&a._state!==c){a._state=c;if(b)a._result=b;a._process()}},_onComplete:function(a){this._changeState(h,a)},_validateAuth:function(){var c=this,e=false;if(a._rpsAuth)c._changeState(b);else{var d;switch(c._props[y]){case W:d=yi;break;case Kb:d=mh;break;case pb:case ob:d=c._buildExternalScope();e=true;break;default:var i=Yd.replace(m,ub).replace(Eb,y);c._onComplete(j(gh,i));return}var h=c._props[f],g=650;if(e)a.login({scope:d,external_consent:true}).then(function(a){c._onExternalConsentComplete(a)},function(a){c._onComplete(a)});else{d+=" "+pf;a.ensurePermission(d,g,h,c._authDelegate)}}},_buildExternalScope:function(){var b=this,a="onedrive_onetime.access:";switch(b._props[y]){case pb:a+=pb;break;case ob:a+=ob}switch(b._props[Hd]){case Hb:a+="file|";break;case Gb:a+="folder|";break;default:a+="file|"}a+=b._props[P]===V?V:Bc;if(b._props[Mb])a+="|"+b._props[Mb];return a},_onAuthResp:function(c){var a=this;if(c.error){if(!a._channel)a._onComplete(c)}else{var e=c.session[d];a._props[d]=e;if(a._channel)a._channel.send(FILEDIALOG_CHCMD_UPDATETOKEN,e);else a._changeState(b)}},_initPicker:function(){var b=this,d=b._props;t(d);b._channel=a.channel.registerOuterChannel(Hg,vd(d.url).host,d.frame.contentWindow,d.url,g(b,b._onMessage));c.subscribe(X,b._authDelegate);var e=function(a){if(a.keyCode===Ji)b.cancel()};d.keydownHandler=e;p(window,"keydown",e);b._initTimeout()},_initTimeout:function(){var a=this;timeoutSeconds=a._props[Dd];if(timeoutSeconds&&timeoutSeconds>0)a._timeout=window.setTimeout(g(a,a._onTimeout),timeoutSeconds*1000)},_onTimeout:function(){var a=this,b=a._channel._connected;if(!b)a.cancel(j(kc,og));a._clearTimeout()},_clearTimeout:function(){var a=this;if(a._timeout){window.clearTimeout(a._timeout);a._timeout=undefined}},_complete:function(){var b=this,c=b._result,d=c.error?o:n;b._state=e;b._cleanup();b._normalizeResp();if(b._props[f]===ub)v(b._props[r],c,true);else if(c.data)v(b._props[Ld],c,true);else v(b._props[yb],c,true);b._promise[d](c);if(!a._rpsAuth)S(function(){b._report()})},_report:function(){var e=this._props,b=this._result,k=((new Date).getTime()-this._startTs)/1000,i="none",c=0,d=0;if(b.data){if(b.data.folders!=null)c=b.data.folders.length;if(b.data.files!=null)d=b.data.files.length}i=c>0&&d>0?"both":c>0?Gb:d>0?Hb:"none";var j=c+d,h={client:bc,api:e[f],mode:e[y],select:e[P],result:b.error?b.error.code:"success",duration:k,object_selected:i,selected_count:j},g=a[Wb];a.api({path:"web_analytics",method:cd,body:h});if(g)g(h)},_onExternalConsentComplete:function(c){var b=this,h=b._props[Mb]===Ib;if(c.error){b._onComplete(c);return}var n=c[AK_OWNER_CID],k=c[AK_RESOURCEID],m=c[AK_ITEMID],l=c[Hi];if(!k){b._onComplete(j(z,"Did not get expected resource id."));return}if(!l&&h){b._onComplete(j(z,"Did not get expected auth key for the resource."));return}var o=a._browser.ie9,i=b._props[Rg],d={method:dc,interface_method:b._props[f]};if(o&&i)d[s]=k+"/files";else{d[bb]=true;d[Qd]=[{name:Lc,value:a._appId},{name:Fc,value:E("{0}={1}",Mc,a._settings.sdk_version)}];var g,e;if(h){g="drives/"+n+"/items/"+m+"?"+Of;e={authKey:l}}else{g="drive/items/"+m+"/children?"+(i?ti:Qg);e={access_token:a.getAccessTokenForApi()}}d[s]=A(g,e)}a.api(d).then(function(d){var a={pickerResponse:c,apiResponse:d};b._onComplete(a)},function(a){b._onComplete(a)})},_onMessage:function(a,b){nb(a);switch(a){case FILEDIALOG_CHCMD_ONCOMPLETE:this._onComplete(b)}},_normalizeResp:function(){var e=this,b=e._result.data,d=e._result.error,g=function(c){var b=c.upload_location;if(b)c.upload_location=b.replace("WL_APISERVICE_URL",a[wb])};if(b){if(b.folders)for(var c=0;c<b.folders.length;c++)g(b.folders[c]);if(b.files)for(var c=0;c<b.files.length;c++)g(b.files[c])}if(d&&d.message)d.message=d.message.replace(m,e._props[f])},_cleanup:function(){var d=this,b=d._props,g=d._channel,f=b.resizeHandler,e=b.keydownHandler;d._clearTimeout();c.unsubscribe(X,d._authDelegate);if(b.lightBox){b.frame.style.display=We;b.lightBox.style.display=We;document.body.removeChild(b.frame);document.body.removeChild(b.lightBox);delete b.lightBox;delete b.frame}if(g){g.dispose();delete d._channel}if(f)C(window,"resize",f);if(e)C(window,"keydown",e);delete a._pendingPickerOp}};function t(c){var f=c[y]===W,e=f?800:500,d=f?600:450,g=c[Lb],m=g===yd,i=m?0:60,n=g===zc?"white":"rgb(0,0,0)",j=i/100,h=k(e,d),l=q(c),b=document.createElement("div");b.style.top="0px";b.style.left="0px";b.style.position="fixed";b.style.width="100%";b.style.height="100%";b.style.display="block";b.style.backgroundColor=n;b.style.opacity=j;b.style.MozOpacity=j;b.style.filter="alpha(opacity="+i+")";b.style.zIndex="2600000";var a=document.createElement("iframe");a.id="picker"+(new Date).getTime();a.style.top=h.top;a.style.left=h.left;a.style.position="fixed";a.style.width=e+"px";a.style.height=d+"px";a.style.display="block";a.style.zIndex="2600001";a.style.borderWidth="1px";a.style.borderColor="gray";a.style.maxHeight="100%";a.style.maxWidth="100%";a.src=l;a.setAttribute("sutra","picker");document.body.appendChild(a);document.body.appendChild(b);c.resizeHandler=function(){var b=k(e,d);a.style.top=b.top;a.style.left=b.left};p(window,"resize",c.resizeHandler);c.lightBox=b;c.frame=a;c.url=l}function q(e){var f=e[y]===W,g=f?If:Gf,b={},c=gf()+a[FILEDIALOG_PARAM_PICKER_SCRIPT];if(c.charAt(0)==="/")c=sc+c;b[rg]=g;b[hh]=a._rpsAuth?qg:gg;b[Lg]=window.location.hostname.toLowerCase();b[Bg]=c;b[AK_CLIENT_ID]=a._appId;b[AK_REQUEST_TS]=(new Date).getTime();b[qh]=a._locale;if(!a._rpsAuth)b[d]=e[d];if(f)b[P]=e[P];return A(a[Ab],b)}function k(f,e){var b,c;if(a._browser.ie){var d=document.documentElement;b=(d.clientWidth-f)/2;c=(d.clientHeight-e)/2}else{b=(window.innerWidth-f)/2;c=(window.innerHeight-e)/2}b=b<10?10:b;c=c<10?10:c;return {left:b+"px",top:c+"px"}}})();var hf=60*1000;fd.prototype._getStrategy=function(e){var i=this,c=e[f],a=e[Q],l=e[tb],j=e[bb];h(e,[{name:Q,type:uc,optional:false}],c);if(typeof a===b)a=document.getElementById(a);if(!(a instanceof HTMLInputElement)||a.type!==ud)throw O(Q,c,'It must be an HTMLInputElement with its type attribute set to"file" (i.e., <input type="file" />).');if(a.value==="")throw O(Q,c,"It did not contain a selected file.");if(a.files&&window.FileReader){if(a.files.length!==1)throw O(Q,c,"It must contain one selected file.");var g=a.files[0];if(g.size>Yg)throw O(Q,c,"Max supported file size for form uploads is 100MB.");var k=l||g.name;i.setFileName(k);return new di(i,g,j,k)}if(j)throw new Error(Vf);if(a.name==="")a.name=ud;var d=null;if(a.form===null)d="It must be a child of an HTMLFormElement.";else if(a.form.length!==1)d="It must be the only HTMLInputElement in its parent HTMLFormElement.";else if(a.name!==ud)d='Its name attribute must be set to "file" (i.e., <input name="file" />).';if(d!==null)throw O(Q,c,d);return new Nd(i,a,c)};function Nd(b,d,c){var a=this;a._op=b;a._iMethod=c;a._element=d;a._uploadIFrame=null;a._uploadTimeoutId=null;b.setFileName(undefined)}Nd.prototype={getId:function(){var a=this;if(a._uploadIFrame===null)a._createUploadIFrame();return a._uploadIFrame.id},setUploadTimeout:function(){var a=this;a._uploadTimeoutId=window.setTimeout(function(){a.onTimeout()},hf)},clearUploadTimeout:function(){var a=this;if(a._uploadTimeoutId===null)return;window.clearTimeout(a._uploadTimeoutId);a._uploadTimeoutId=null},onTimeout:function(){var a=this;a._uploadTimeoutId=null;var b=a._iMethod+": did not receive a response in "+hf+" milliseconds.",c=j(kc,b);a._op.uploadComplete(false,c)},onUploadComplete:function(a){var b=this;b.clearUploadTimeout();b._removeUploadIFrame();a=ed(a);var d=a.error,c=typeof d===hb;b._op.uploadComplete(c,a)},upload:function(a){this._multiPartFormUpload(a)},_getRequestUrl:function(d){var b={};b[AK_REDIRECT_URI]=a._redirect_uri;var c={};c[qc]=ue;c[df]=this.getId();b[AK_STATE]=K(c);return A(d,b)},_createUploadIFrame:function(){var a=this;if(a._uploadIFrame!==null)return;a._uploadIFrame=Ub("iframe");a._uploadIFrame.name=a._uploadIFrame.id=Oc();document.body.appendChild(a._uploadIFrame)},_multiPartFormUpload:function(c){var a=this;a._createUploadIFrame();var b=a._getRequestUrl(c);a._submitForm(b);a.setUploadTimeout();vb.add(a);Cg()},_removeUploadIFrame:function(){var a=this;if(a._uploadIFrame===null)return;a._uploadIFrame.parentNode.removeChild(a._uploadIFrame);a._uploadIFrame=null},_submitForm:function(c){var b=this,a=b._element.form;a.target=b._uploadIFrame.name;a.method=cd;a.enctype="multipart/form-data";a.action=c;a.submit()}};function Cd(){this._pendingUploads={}}Cd.prototype={add:function(a){var b=a.getId();this._pendingUploads[b]=a},hasPendingUploads:function(){for(var a in this._pendingUploads)return true;return false},isPending:function(a){return a in this._pendingUploads},get:function(a){return this._pendingUploads[a]},remove:function(a){delete this._pendingUploads[a]}};var vb=new Cd,Cg=function(){var b=false,a=new Cb(kf),c=function(){var d=a.getStates(),c=false;for(var b in d){if(!vb.isPending(b))continue;var f=d[b],e=vb.get(b);vb.remove(b);a.remove(b);c=true;e.onUploadComplete(f)}if(!vb.hasPendingUploads())a.stopMonitor();if(c){a.save();c=false}};return function(){if(a.isBeingMonitored())return;if(b)a.startMonitor();else{a.addCookieChanged(c);b=true}}}();function di(b,c,d,e){this.upload=function(h){var f=null;if(window.File&&c instanceof window.File)f=new FileReader;f.onerror=function(a){error=a.target.error;b.onErr(error.name)};f.onload=function(i){var f=i.target.result,c=new XMLHttpRequest;if(d)h=E(h,e);c.open(qi,h,true);if(d){c.setRequestHeader(ne,"text/plain");c.setRequestHeader(Lc,a._appId);c.setRequestHeader(Fc,E("{0}={1}",Mc,a._settings.sdk_version))}c.onload=function(a){b.onResp(a.currentTarget.responseText)};c.onerror=function(a){b.onErr(a.currentTarget.statusText)};if(c.upload)c.upload.onprogress=function(a){if(a.lengthComputable){var c={bytesTransferred:a.loaded,totalBytes:a.total,progressPercentage:a.total===0?0:a.loaded/a.total*100};b.uploadProgress(c)}};b._cancel=g(c,c.abort);c.send(f)};f.readAsArrayBuffer(c)}}function Tg(){a._isHttps=document.location.protocol.toLowerCase()==sc}function Ii(){if(a._browser.flash!==undefined)return;var b=0;try{if(a._browser.ie){var k=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),f=k.GetVariable("$version"),i=f.split(" "),g=i[1],d=g.split(",");b=d[0]}else if(navigator.plugins&&navigator.plugins.length>0)if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var j=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",e=navigator.plugins["Shockwave Flash"+j].description,h=e.split(" "),c=h[2].split(".");b=c[0]}}catch(l){}a._browser.flashVersion=b;a._browser.flash=b>=8}function ri(){if(a._documentReady===undefined)a._documentReady=(new Date).getTime()}function Ch(b){cb(function(){if(a._browser.firefox&&(!a._documentReady||(new Date).getTime()-a._documentReady<1000))window.setTimeout(b,1000);else b()})}function cb(b){if(document.body)switch(document.readyState){case "complete":b();return;case "loaded":if(a._browser.webkit){b();return}break;case "interactive":case undefined:if(a._browser.firefox||a._browser.webkit){b();return}}if(document.addEventListener){document.addEventListener("DOMContentLoaded",b,false);document.addEventListener("load",b,false)}else if(window.attachEvent)window.attachEvent("onload",b);if(a._browser.ie&&document.attachEvent)document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);b()}})}function qf(b,a){b.innerHTML=a}function p(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent("on"+b,c)}function C(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,false);else if(a.detachEvent)a.detachEvent("on"+b,c)}function Ph(){var a=gb(qd);if(a){var b=a.getAttribute(Oe);!b&&k(E("Could not find attribute '{0}' on element with id '{1}'.",Oe,qd),fc);return b}else{k(E("Could not find element with id '{0}'.",qd),fc);return null}}var gd={registerOuterChannel:function(e,b,c,d,a){return F.registerChannel(e,b,c,d,a)},registerInnerChannel:function(c,b,a){return F.registerChannel(c,b,null,null,a)},isSupported:function(){return F.isSupported()}},F={_channels:[],isSupported:function(){return window.postMessage!=null},registerChannel:function(h,e,f,g,d){var b=F,c=b._channels,a=null;if(b.isSupported()){a=new Ie(h,e,f,g,d);if(c.length===0)p(window,"message",b._onMessage);c.push(a)}return a},unregisterChannel:function(d){var c=F,a=c._channels;for(var b=0;b<a.length;b++)if(a[b]==d){a.splice(b,1);break}if(a.length===0)C(window,"message",c._onMessage)},_onMessage:function(a){var d=F,a=a||window.event,c=si(a);if(c!=null){var b=d._findChannel(a,c);if(b!=null)switch(c.text){case uf:b._onConnectReq(a.source,a.origin);break;case tf:b._onConnectAck(a.source);break;default:b._onMessage(c.text)}}},_findChannel:function(g,f){var d=F,c=d._channels,e=Ci(g.origin);for(var b=0;b<c.length;b++){var a=c[b];if(Td(a._name,f.name)&&Td(a._allowedDomain,e))return a}return null}},uf="@ConnectReq",tf="@ConnectAck";function Ie(f,d,b,e,c){var a=this;a._name=f;a._allowedDomain=d;a._msgHandler=c;if(b){a._targetWindow=b;a._targetUrl=pi(e);a._connect()}}Ie.prototype={_disposed:false,_connected:false,_allowedDomain:null,_targetWindow:null,_targetUrl:null,_msgHandler:null,_connectSchedule:-1,_pendingQueue:[],_recvQueue:[],dispose:function(){var a=this;if(!a._disposed){a._disposed=true;a._cancelConnect();F.unregisterChannel(a)}},send:function(c,d){var a=this;if(a._disposed)return;var b=oh(c,d);if(a._connected)a._post(b);else a._pendingQueue.push(b)},_connect:function(){var a=this;if(a._disposed||a._connected)return;var b=function(){a._post(uf)};if(a._connectSchedule===-1){a._connectSchedule=window.setInterval(b,500);b()}},_post:function(b){var a=this,c=Xh(a._name,b);a._targetWindow.postMessage(c,a._targetUrl)},_onConnectReq:function(c,b){var a=this;if(!a._connected){a._connected=true;a._targetWindow=c;a._targetUrl=b;a._post(tf);a._onConnected()}},_onConnectAck:function(b){var a=this;if(!a._connected){a._targetWindow=b;a._onConnected()}},_onConnected:function(){var a=this,c=a._pendingQueue;a._connected=true;for(var b=0;b<c.length;b++)a._post(c[b]);a._pendingQueue=[];a._cancelConnect()},_cancelConnect:function(){var a=this;if(a._connectSchedule!=-1){window.clearInterval(a._connectSchedule);a._connectSchedule=-1}},_onMessage:function(b){if(this._msgHandler){var a=nh(b);this._msgHandler(a.cmd,a.args)}}};function pi(b){var a=b.indexOf("://");if(a>=0){a=b.indexOf("/",a+3);if(a>=0)b=b.substring(0,a)}return b}function si(a){var b=null;if(!Ce(a.origin)&&!Ce(a.data)&&a.source!=null)b=Wh(a.data);return b}function Xh(a,b){return "<"+a+">"+b}function Wh(a){var c=null;if(a.charAt(0)=="<"){var b=a.indexOf(">");if(b>0){var d=a.substring(1,b),e=a.substr(b+1);c={name:d,text:e}}}return c}function oh(a,c){var b={cmd:a,args:c};return JSON.stringify(b)}function nh(b){var a=JSON.parse(b);return a}if(window.WL)a.channel=gd;else window.WL={channel:gd};var x={connect:"Connect",signIn:"Sign in",signOut:"Sign out",login:"Log in",logout:"Log out",skyDriveOpenPickerButtonText:"Open from OneDrive",skyDriveOpenPickerButtonTooltip:"Open from OneDrive",skyDriveSavePickerButtonText:"Save to OneDrive",skyDriveSavePickerButtonTooltip:"Save to OneDrive"};a._locale="en";a[N]="Web/DEVICE_"+dh("5.5.9816.3005");a.testInit=function(b){if(b.env)a._settings.init(b.env);if(b.skydrive_uri)a._settings[Ab]=b.skydrive_uri;if(b[Wb])a[Wb]=b[Wb]};var ib={};ib[oc]="login.live.com";ib[wb]="https://apis.live.net/v5.0/";ib[Ab]="https://onedrive.live.com/";ib[T]="//js.live.net/v5.0/";ib[hc]="https://api.onedrive.com/v1.0/";var mb={};mb[oc]="login.live.com";mb[wb]="https://apis.live.net/v5.0/";mb[Ab]="https://onedrive.live.com/";mb[T]="//df-js.live.net/v5.0/";mb[hc]="https://df.api.onedrive.com/v1.0/";var kb={};kb[oc]="login.live-int.com";kb[wb]="https://apis.live-int.net/v5.0/";kb[Ab]="https://onedrive.live-int.com/";kb[T]="//js.live-int.net/v5.0/";kb[hc]="https://newapi.storage.live-int.com/v1.0/";a._settings={sdk_version:"js-v1.0",PROD:ib,DF:mb,INT:kb,init:function(b){b=b.toUpperCase();var c=this[b];if(c)q(c,a)}};a._settings.init("PROD");a[FILEDIALOG_PARAM_PICKER_SCRIPT]="wl.skydrivepicker.js";a.onloadInit();t.onloadInit()}})();
